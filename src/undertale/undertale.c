#include "undertale.h"
#include <time.h>

// void delay(int number_of_seconds)
// {
//     // Converting time into milli_seconds
//     int milli_seconds = 1000 * number_of_seconds;
 
//     // Storing start time
//     clock_t start_time = clock();
 
//     // looping till required time is not achieved
//     while (clock() < start_time + milli_seconds);
// }

void toriel(BinTree* p , char*name , int *score)
{
    printf("              C H A P T E R - 1 , T O R I E L            \n");
    printf("************************************************************\n");
    delay(2);
    printf("Your journey in the underground have started...\n");
    printf("You encounter a flower-like creature, and it talks!\n");
    delay(2);
    printf("\n");
    printf("⣿⣿⣿⣿⣿⣿⣿⡿⢿⣏⣉⠉⠙⠿⢿⣿⠿⠏⠉⠉⣽⡿⠿⣿⣿⣿⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⣿⣿⣿⣅⠀⣄⣴⣿⣿⠿⠿⠿⠿⠿⠿⣿⣿⣿⣤⠀⢨⣿⣿⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⠏⠉⠉⢿⣿⣿⠏⠀⠀⢀⣀⠀⠀⣄⡀⠀⠀⠙⢿⣿⡿⠋⠉⠙⢿⣿⣿\n");
    printf("⣿⡏⠀⠲⠶⠶⣾⣿⠀⠀⠀⠀⢸⣿⠀⠀⣿⡇⠀⠀⠀⠀⣿⣷⠶⠶⠶⠀⠙⣿\n");
    printf("⣿⣷⣦⡀⠀⠀⢸⣿⣄⠀⠰⢦⣈⣉⣀⣀⣩⣁⣰⠆⠀⢀⣿⡇⠀⠀⠀⣰⣶⣿\n");
    printf("⣿⣿⣿⣿⣶⣶⣶⡾⣿⣆⠀⠀⠙⠶⠶⠶⠶⠎⠀⠀⣠⣾⠿⣶⣶⣶⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⣿⡿⠏⠀⢠⠿⢿⣿⣶⣄⣀⣀⣀⣀⣀⣶⣾⣿⠿⣄⠀⠙⢿⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⣿⡇⠀⠸⠇⠀⠀⠀⠈⢻⣋⣹⣏⣙⡏⠉⠀⠀⠀⠘⠇⠀⢸⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⣿⣿⣿⣶⣶⣶⣶⣿⣿⣿⡿⢿⣿⣿⣿⣿⣿⣶⣶⣶⣶⣿⣿⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣀⠀⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⠀⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠧⠀⠸⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿\n");
    printf("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠧⠀⠸⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿\n");
    printf("\n");
    delay(2);
    printf("Peculiar Flower: Hi.. I'm Flowey!\n");
    printf("\n");
    printf("You sense a peculiarity in it, and not long after...\n");
    delay(3);
    printf("\n");
    printf("\n");
    printf("\n");
    printf("D   I   E   !\n");
    printf("\n");
    printf("\n");
    printf("\n");
    printf("Oh no, the flower is actually evil!  (꒪_/꒪)\n");
    printf("Luckily, not long after... a goat creature came to your rescue!\n");
    delay(2);
    printf("Toriel: Oh.. Hello!\n");
    delay(2);
    printf("Toriel: My name is Toriel, keeper of the Undergrounds!\n");
    delay(2);
    printf("Toriel: Please be careful, my child, as this place is not safe\n");
    printf("\n");
    delay(2);
    printf("-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-");
    printf("\n");
    printf("Toriel then brings you to her home and cares for you. It seems like\n");
    delay(2);
    printf("She had lost her own child before, and so she is very protective of you...\n");
    delay(2);
    printf("But you must return to your world. You cannot remain.\n");
    delay(2);
    printf("To do so, one day, you went to the gate she explicitly told you to avoid...\n");
    printf("\n");
    delay(2);
    printf("Toriel arrives shortly afterwards with a dissapointed look on her face.\n");
    delay(2);
    printf("Toriel: My dear child.. I cannot let you through these gates...\n");
    delay(2);
    printf("However... must you insist, you'll need to face me first...\n");
    delay(2);
    printf("Prove to me, child, that you are strong enough to proceed.\n");
    delay(2);
    printf("\n");
    delay(3);
    printf("************************************************************\n");
    printf("      Y O U - H A V E - E N T E R E D - A - F I G H T\n");
    printf("************************************************************\n");
    printf("\n");

    torielfight(score,name);

    printf("You have succeeded in defeating Toriel. Would you like to Kill or Spare her? (K/S) \n");
    boolean lanjut = false;
    while (!lanjut)
    {
        STARTCMD();
        if (wordStringEq(CURRENTCOMMAND,"K"))
        {
            lanjut = true;
            printf("Toriel: Why.. would.. you do this..?\n");
            printf("Toriel perished. You open the gate in front of you to proceed in your journey.\n");
            printf("\n");
            *p = Left(*p);
        } else if (wordStringEq(CURRENTCOMMAND,"S")) {
            lanjut = true;
            printf("Toriel: My child.. you have a kind heart.\n");
            printf("Toriel: Proceed as you wish. May you always be protected.\n");
            printf("You hugged Toriel, and stepped onto the gate to proceed with your Journey.\n");
            *p = Right(*p);
        } else {
            printf("Please input K or S in capital.\n");
        }

    }
}

void papyrus(BinTree* p , char*name , int *score)
{
    printf("              C H A P T E R - 2 , P A P Y R U S           \n");
    printf("************************************************************\n");
    delay(2);
    printf("You have just emerged outside of the Ruins (Undergrounds)...\n");
    delay(2);
    printf("You have reached an area filled with snow...\n");
    printf("❄ ❄ ❄ ❄ ❄ ❄ ❄\n");
    printf("      ❄ ❄ ❄ ❄ ❄ ❄ ❄\n");
    printf("              ❄ ❄ ❄ ❄ ❄ ❄ ❄\n");
    printf("                     ❄ ❄ ❄ ❄ ❄ ❄ ❄\n");
    printf("                             ❄ ❄ ❄ ❄ ❄ ❄ ❄\n");
    printf("\n");
    delay(2);
    printf("Behind all the trees and snow.. you discovered what looks like.. a skull?!\n");
    delay(2);
    printf("Sans: Hey, human!\n");
    delay(2);
    printf("Sans: Quick, hide behind that lamp!\n");
    delay(2);
    printf("Sans points to a nearby lamp. You notice a taller, more slender skeleton approaching\n");
    delay(2);
    printf("You quickly hid behind the lamp.\n");
    delay(2);
    printf("\n");
    printf("Papyrus: Hey, don't you smell a human nearby?\n");
    delay(2);
    printf("Sans: Oh hey, bro! Ahh, it's probably just you and your mind.\n");
    delay(2);
    printf("Papyrus: Hmm... is that so..\n");
    delay(2);
    printf("Papyrus: Oh well, I'm off then!\n");
    delay(2);
    printf("\n");
    printf("Papyrus leaves the scene.\n");
    delay(2);
    printf("\n");
    printf("Sans: He's gone, Kid\n");
    delay(2);
    printf("You emerge out of the lamp to thank him. Sans left afterwards.\n");
    delay(2);
    printf("You continue to walk...\n");
    delay(2);
    printf("To your surprise, Papyrus was still nearby and ambushed you.\n");
    delay(2);
    printf("Papyrus: ALL HUMANS SHALL PERISH!\n");

    delay(2);
    printf("\n");
    printf("************************************************************\n");
    printf("      Y O U - H A V E - E N T E R E D - A - F I G H T\n");
    printf("************************************************************\n");

    printf("\n");
    papyrusfight(score,name);
    printf("\n");

    printf("You have succeeded in defeating Papyrus. Would you like to Kill or Spare him? (K/S) \n");
    boolean lanjut = false;
    while (!lanjut)
    {
        STARTCMD();
        if (wordStringEq(CURRENTCOMMAND,"K"))
        {
            lanjut = true;
            delay(2);
            printf("Papyrus: I knew it.. humans are nothing but trash...\n");
            delay(2);
            printf("Papyrus perished. You aim for King Asriel's palace, the only way out from the Undergrounds..\n");
            printf("\n");
            *p = Left(*p);
        } else if (wordStringEq(CURRENTCOMMAND,"S")) {
            lanjut = true;
            delay(2);
            printf("Papyrus: But.. but I thought humans were bad..\n");
            printf("Papyrus: Seems that I have misjudged you.. I apologize..\n");
            delay(2);
            printf("Papyrus: From now on, Papyrus will always be by your side!\n");
            printf("You shook hands with Papyrus, and he led you towards King Asriel's palace, the only way out from the Undergrounds..\n");
            *p = Right(*p);
        } else {
            printf("Please input K or S in capital.\n");
        }
    } 
}

void lastcorridor()
{
    printf("        C H A P T E R - 3 , L A S T - C O R R I D O R       \n");
    printf("************************************************************\n");
    delay(2);
    printf("\n");
    printf("You have reached King Asriel's palace.\n");
    delay(2);
    printf("Using the elevators inside, you went straight to the top level.\n");
    delay(2);
    printf("It's the corrdior before King Asriel's throne.\n");
    delay(2);
    printf("On the edge of the palace, you see a familiar sight.\n");
    printf("\n");
    printf("\n");
    printf("\n");
    printf("░░░░░░░░██████████████████\n");
    printf("░░░░████░░░░░░░░░░░░░░░░░░████\n");
    printf("░░██░░░░░░░░░░░░░░░░░░░░░░░░░░██\n");
    printf("░░██░░░░░░░░░░░░░░░░░░░░░░░░░░██\n");
    printf("██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██\n");
    printf("██░░░░░░░░░░░░░░░░░░░░██████░░░░██\n");
    printf("██░░░░░░░░░░░░░░░░░░░░██████░░░░██\n");
    printf("██░░░░██████░░░░██░░░░██████░░░░██\n");
    printf("░░██░░░░░░░░░░██████░░░░░░░░░░██\n");
    printf("████░░██░░░░░░░░░░░░░░░░░░██░░████\n");
    printf("██░░░░██████████████████████░░░░██\n");
    printf("██░░░░░░██░░██░░██░░██░░██░░░░░░██\n");
    printf("░░████░░░░██████████████░░░░████\n");
    printf("░░░░░░████░░░░░░░░░░░░░░████\n");
    printf("░░░░░░░░░░██████████████\n");
}

void megalovania(BinTree* p , char*name , int*score)
{
    lastcorridor();

    printf("\n");
    printf("Sans: Heya, Kid.\n");
    delay(2);
    printf("Sans: You've been busy, Huh?\n");
    delay(2);
    printf("Sans: Just going around, killing everyone you see\n");
    delay(3);
    printf("Sans: So, i've got a question for ya.");
    delay(2);
    printf("Sans: Do you think even the worst person can change?\n");
    delay(2);
    printf("\n");
    printf("Despite his dialogue, you step forward, bringing out your knife.\n");
    delay(2);
    printf("\n");
    printf("Sans: Heh.. here's a better question.\n");
    delay(2);
    printf("Sans: Do you wanna have a bad time? Cause if you step forward...\n");
    delay(2);
    printf("Sans: You're REALLY not going to like what happens next.\n");
    delay(2);
    printf("\n");
    delay(3);
    printf("You take one more step forward.\n");
    printf("\n");
    delay(2);
    printf("Sans: Welp, here we go.\n");

    delay(2);
    printf("\n");
    printf("************************************************************\n");
    printf("      Y O U - H A V E - E N T E R E D - A - F I G H T\n");
    printf("************************************************************\n");
    printf("\n");

    sansfight(score,name);
    printf("\n");

    printf("You have succeeded in defeating Sans. Would you like to Kill or Spare him? (K/S) \n");
    boolean lanjut = false;
    while (!lanjut)
    {
        STARTCMD();
        if (wordStringEq(CURRENTCOMMAND,"K"))
        {
            lanjut = true;
            printf("Sans: Heh.. heh...\n");
            delay(2);
            printf("Sans: At least.. I get to be with my brother now..\n");
            delay(2);
            printf("\n");
            printf("You proceed to Asriel's throne.\n");
            printf("\n");
            *p = Left(*p);
        } else if (wordStringEq(CURRENTCOMMAND,"S")) {
            lanjut = true;
            delay(2);
            printf("Sans: You should've just killed me.. kid.\n");
            delay(2);
            printf("Sans: Just like you did with everyone else, right?\n");
            delay(2);
            printf("Sans: Just like you did.. with my brother.\n");
            printf("\n");
            delay(2);
            printf("You proceed to Asriel's throne.\n");
            printf("\n");
            *p = Right(*p);
        } else {
            printf("Please input Y or N in capital.\n");
        }
    }

}

void sansneutral(BinTree* p , char*name , int *score)
{
    lastcorridor();
    printf("\n");
    delay(2);
    printf("Sans: Heya, Kid.\n");
    delay(2);
    printf("Sans: How does it feel? You're finally at the end of your journey...\n");
    delay(2);
    printf("Sans: Beyond these gates, is the throne of King Asriel\n");
    delay(2);
    printf("Sans: There, you will be at the pinnacle of life and death...\n");
    delay(3);
    printf("Sans: Take a moment to reflect upon your actions in the past...\n");
    delay(2);
    printf("Sans: Those people that you've murdered.. and those you've spared\n");
    delay(2);
    printf("Sans: Well.. at least you were honest with yourself..\n");
    delay(3);
    *p = Left(*p);
}

void sanspacifist(BinTree* p ,char*name , int *score)
{
    lastcorridor();
    printf("\n");
    printf("Sans: Heya, Kid.\n");
    delay(2);
    printf("Sans: How does it feel? You're finally at the end of your journey...\n");
    delay(2);
    printf("Sans: Beyond these gates, is the throne of King Asriel\n");
    delay(2);
    printf("Sans: There, you will be at the pinnacle of life and death...\n");
    delay(2);
    printf("Sans: Take a moment to reflect upon your actions in the past...\n");
    delay(3);
    printf("Sans: ...\n");
    delay(2);
    printf("Sans: But you've always been a kind soul, haven't you?\n");
    delay(2);
    printf("Sans: Even if you're thrown in situations that you didn't want to face\n");
    delay(2);
    printf("Sans: Even if you ran away.. you ran away with a smile\n");
    delay(2);
    printf("Sans: You gained love from all of us.\n");
    delay(2);
    printf("Sans: We're all rooting for ya, Kid.\n");
    *p = Left(*p);
}

void asriel(BinTree p , char*name , int *score)
{
    printf("              C H A P T E R - 4 , T H E  E N D   \n");
    printf("************************************************************\n");
    printf("\n");
    printf("                              {} {}\n");
    printf("                        !  !  II II  !  !\n");
    printf("                     !  I__I__II II__I__I  !\n");
    printf("                     !  I__I__II II__I__I  !\n");
    printf("                     I_/|--|--||   ||--|____I\n");
    printf("                     |_____|           |____|\n");
    printf("                     |_____|           |____|\n");
    printf("                     |_____|           |____|\n");
    printf("                     |_____|           |____|\n");
    printf("                     |_____|           |____|\n");
    printf("                     |_____|           |____|\n");
    printf("                     |_____|           |____|\n");
    printf("                     |_____|           |____|\n");
    printf("                     |_____|           |____|\n");
    printf("                     I_/|--|--||   ||--|____I\n");
    printf("                     !   I__I__II II__I__I  !\n");
    printf("                    ||I      ---------      I||\n");
    printf("                    ||I      ---------      I||\n");
    printf("                    //      ---------       I__\n");
    printf("\n");
    printf("You finally reached Asriel's Throne.\n");
    delay(3);
    printf("Asriel: Welcome, Human.\n");
    delay(3);
    printf("Asriel: You know what must happen... right?\n");
    delay(3);
    printf("Asriel: You know what I must do.. to protect the creatures in the Underground...\n");
    
    if (p->Info=='H')
    {
        delay(3);
        printf("Asriel: But I guess you do not have the heart... to understand that\n");
        delay(2);
        printf("Asriel gets off his throne.\n");
        delay(2);
        printf("Asriel: Whenever you're ready, human.\n");
    } else if (p->Info=='O') {
        delay(2);
        printf("Asriel: Even though I do not want to.. since you have the kindest heart.\n");
        delay(3);
        printf("Asriel: Forgive me, human.\n");
        delay(2);
        printf("Asriel gets off his throne.\n");
        delay(2);
        printf("Asriel: Whenever you're ready, human.\n");
    } else {
        delay(2);
        printf("Asriel gets off his throne.\n");
        delay(2);
        printf("Asriel: Whenever you're ready, human.\n");
    }

    printf("\n");
    printf("Are you read to fight Asriel? (Y/N)\n");
    boolean ready = false;
    while (!ready)
    {
        STARTCMD();
        if (wordStringEq(CURRENTCOMMAND,"Y"))
        {
            ready = true;
        } else if (wordStringEq(CURRENTCOMMAND,"N")) {
            printf("Take your time.\n");
            printf("Type in 'Y' whenever you are ready.\n");
        } else {
            printf("Please input Y or N in capital\n");
        }
    }

    printf("\n");
    printf("************************************************************\n");
    printf("      Y O U - H A V E - E N T E R E D - A - F I G H T\n");
    printf("************************************************************\n");
    printf("\n");

    asrielfight(score,name);
}

boolean end(char a)
{
    return a == 'H' || a == 'I' || a == 'J' || a == 'K' || a == 'L' || a == 'M' || a == 'N' || a == 'O';
}

void beginning()
{
    printf("                 T H E - B E G I N N I N G                  \n");
    printf("************************************************************\n");
    printf("Long ago, two races ruled over Earth: HUMANS and MONSTERS\n");
    printf("One day, war broke out between the two races.\n");
    printf("After a long battle, the humans were victorious\n");
    printf("They sealed the monsters underground with a magic spell.\n");
    printf("Many years later...a human fell into the depths of Mt. Ebbot\n");
    printf("************************************************************\n");
    printf("\n");
}
void createRoute(BinTree* route, BinTree* l, BinTree* r)
{
    MakeTree('A',*l,*r,route);
    AddDaun (route,'A','B', true);
    AddDaun (route,'A','C', false);
    AddDaun (route,'B','D', true);
    AddDaun (route,'B','E', false);
    AddDaun (route,'C','F', true);
    AddDaun (route,'C','G', false);
    AddDaun (route,'D','H', true);
    AddDaun (route,'D','I', false);
    AddDaun (route,'E','J', true);
    AddDaun (route,'E','K', false);
    AddDaun (route,'F','L', true);
    AddDaun (route,'F','M', false);
    AddDaun (route,'G','N', true);
    AddDaun (route,'G','O', false);
}

void undertale()
{
    printf(" _______ _______ _____  _______ ______ _______ _______ _____   _______ \n");
    printf("|   |   |    |  |     \\    ___|   __ \\_    _|   _   |     |_|    ___|\n");
    printf("|   |   |       |  --  |    ___|      < |   | |       |       |    ___|\n");
    printf("|_______|__|____|_____/|_______|___|__| |___| |___|___|_______|_______|\n");

    printf("\n");    
    printf("\n"); 
    printf("\n");                                               

    printf("░░░░░░░░░░░▄▀▄▀▀▀▀▄▀▄░░░░░░░░░░░░░░░░░░\n");
    printf("░░░░░░░░░░░█░░░░░░░░▀▄░░░░░░▄░░░░░░░░░░\n");
    printf("░░░░░░░░░░█░░▀░░▀░░░░░▀▄▄░░█░█░░░░░░░░░\n");
    printf("░░░░░░░░░░█░▄░█▀░▄░░░░░░░▀▀░░█░░░░░░░░░\n");
    printf("░░░░░░░░░░█░░▀▀▀▀░░░░░░░░░░░░█░░░░░░░░░\n");
    printf("░░░░░░░░░░█░░░░░░░░░░░░░░░░░░█░░░░░░░░░\n");
    printf("░░░░░░░░░░█░░░░░░░░░░░░░░░░░░█░░░░░░░░░\n");
    printf("░░░░░░░░░░░█░░▄▄░░▄▄▄▄░░▄▄░░█░░░░░░░░░░\n");
    printf("░░░░░░░░░░░█░▄▀█░▄▀░░█░▄▀█░▄▀░░░░░░░░░░\n");
    printf("░░░░░░░░░░░░▀░░░▀░░░░░▀░░░▀░░░░░░░░░░░░\n");

    printf("\n");  
    printf("\n");  

    printf("Type 'START' in all capitals to start! ");

    STARTCMD();

    while (!wordStringEq(CURRENTCOMMAND,"START"))
    {
        printf("Invalid command! (꒪‸/꒪)\n");
        printf("Type 'START' in all capitals to start!");
        STARTCMD();
    }

    printf("\n");  

    BinTree route,l,r;
    createRoute(&route,&l,&r);
    
    BinTree pointer = route;

    int score = 0;

    beginning();

    // Giving the character a name
    printf("\n");
    printf("(。╹‿ ╹ 。)\n");
    printf("Name the fallen Human\n");
    STARTCMD();
    char* name;
    /*Ini aku ijin ganti funsginya*/
    name = KATATOSTRING(CURRENTCOMMAND);
    boolean correct = false;
    while (!correct)
    {
        printf("Is this name correct? (Y/N)\n");
        printf("%s\n", name);
        printf("\n");
        STARTCMD();
        printf("\n");
        if (wordStringEq(CURRENTCOMMAND,"Y"))
        {
            correct = true;
        } else if (wordStringEq(CURRENTCOMMAND,"N")) {
            printf("Name the fallen Human\n");
            STARTCMD();
        } else {
            printf("Please input Y or N in capital\n");
        }
    }

    printf("Dear %s, WELCOME TO UNDERTALE.\n", name);
    printf("In undertale, your every choice determines how your story ends.\n");
    printf("Choose wisely. Follow your heart.\n");
    printf("\n");

    while (!end(pointer->Info))
    {
        if (pointer->Info == 'A')
        {
            toriel(&pointer , name , &score);
        } else if (pointer->Info == 'B' || pointer->Info == 'C') {
            papyrus(&pointer , name , &score);
        } else {
            if (pointer->Info == 'D')
            {
                megalovania(&pointer , name , &score);
            } else if (pointer->Info == 'G') {
                sanspacifist(&pointer , name , &score);
            } else {
                sansneutral(&pointer , name , &score);
            }
        }
    }

    asriel(pointer , name , &score);

    printf("\n");
    printf("***************************************************************************\n");
    printf("      Y O U - H A V E - E S C A P E D - T H E - U N D E R G R O U N D\n");
    printf("***************************************************************************\n");
    printf("\n");

    printf("Thank you for playing\n");
    printf(" _______ _______ _____  _______ ______ _______ _______ _____   _______ \n");
    printf("|   |   |    |  |     \\    ___|   __ \\_    _|   _   |     |_|    ___|\n");
    printf("|   |   |       |  --  |    ___|      < |   | |       |       |    ___|\n");
    printf("|_______|__|____|_____/|_______|___|__| |___| |___|___|_______|_______|\n");
    printf("\n");
    printf("Remember that every choice you make in life Matters.\n");
    printf("\n");

}

//int main()
//{
//    undertale();
//    return 0;
//}
